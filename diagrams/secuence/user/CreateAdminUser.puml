@startuml
skin rose

title Create Admin User

actor Client
boundary "UserController" as Controller
control "UserService" as Service
participant "<<UseCase>> \n CreateAdminUserUseCase" as UseCase
participant "<<Helper>> \n SecretKeyHelper" as SecretKeyHelper
collections "<<Repository>> \n UserRepository" as UserRepository
participant "<<Helper>> \n AuthHelper" as Auth

Client -> Controller: POST /api/users/admin
activate Controller

Controller -> Service: createAdminUser(request: CreateAdminUserReq)
activate Service

Service -> UseCase: execute(command: Command)
activate UseCase

note right of UseCase: 1. Validate the secret key.
UseCase -> SecretKeyHelper: isValid(secret: String)
activate SecretKeyHelper
SecretKeyHelper --> UseCase: true
deactivate SecretKeyHelper

note right of UseCase: 2. Check if the username already exists.
UseCase -> UserRepository: getByUsername(username: String)
activate UserRepository
UserRepository --> UseCase: null
deactivate UserRepository

note right of UseCase: 3. Create the new admin user.
UseCase -> Auth: hashPassword(password: String)
activate Auth
Auth --> UseCase: hashedPassword: String
deactivate Auth

note right of UseCase: 4. Save the user.
UseCase -> UserRepository: save(user: User)
activate UserRepository
UserRepository --> UseCase: saved: User
deactivate UserRepository

note right of UseCase: 5. End of Use Case.
UseCase --> Service: result: Result
deactivate UseCase

Service --> Controller: response: CreateAdminUserRes
deactivate Service

Controller --> Client: 200 OK (response: CreateAdminUserRes)
deactivate Controller

hide footbox
@enduml
